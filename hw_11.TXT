USE vk_test;

-- Оптимизация запросов Создайте таблицу logs типа Archive. Пусть при каждом создании записи в таблицах users, catalogs и products в таблицу logs помещается время и дата создания записи, название таблицы, идентификатор первичного ключа и содержимое поля name.

CREATE TABLE logs (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  table_name varchar(50) NOT NULL,
  content_id INT UNSIGNED NOT NULL,
  content_name varchar(255)
) ENGINE = Archive;

SELECT * FROM logs;

INSERT INTO users VALUES(NULL, 'Thomas', 'Sales', 'Thomas@gmail.com',+78956443215,'2009-03-08','2009-03-08' );

CREATE TRIGGER products_insert AFTER INSERT ON products
FOR EACH ROW
BEGIN
    INSERT INTO Logs VALUES (NULL, DEFAULT, "products", NEW.id, NEW.name);
END;

CREATE TRIGGER users_insert AFTER INSERT ON users
FOR EACH ROW
BEGIN
    INSERT INTO Logs VALUES (NULL, DEFAULT, "users", NEW.id, NEW.name);
END;

CREATE TRIGGER catalogs_insert AFTER INSERT ON catalogs
FOR EACH ROW
BEGIN
    INSERT INTO Logs VALUES (NULL, DEFAULT, "catalogs", NEW.id, NEW.name);
END;



-- 1 задание В базе данных Redis подберите коллекцию для подсчета посещений с определенных IP-адресов.
127.0.0.1:6379> HSET adress 192.168.9.1 1
(integer) 1
127.0.0.1:6379> HSET adress 192.168.9.3 2
(integer) 1
127.0.0.1:6379> HSET adress 192.168.1.3 3
HGETALL adress


-- 2 задание При помощи базы данных Redis решите задачу поиска имени пользователя по электронному адресу и наоборот,
-- поиск электронного адреса пользователя по его имени.


127.0.0.1:6379> HSET email 'vasiliy' 'vasiliy@gmail.com'
(integer) 1
127.0.0.1:6379> HSET email 'andrey' 'andrey@gmail.com'
(integer) 1
127.0.0.1:6379> HGET email 'andrey'
"andrey@gmail.com"
127.0.0.1:6379> HSET user 'andrey@gmail.com' 'andrey'
(integer) 1
127.0.0.1:6379> HGET user 'andrey@gmail.com'
"andrey"

